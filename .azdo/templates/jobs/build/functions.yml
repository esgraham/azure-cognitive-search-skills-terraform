jobs:
- job: BuildFunctions
  steps:
  - task: DotNetCoreCLI@2
    displayName: Restore NuGet packages
    inputs:
      command: 'restore'
      projects: '$(Build.SourcesDirectory)/src/CognitiveSkills.sln'

  - task: DotNetCoreCLI@2
    displayName: Build solution
    inputs:
      projects: '$(Build.SourcesDirectory)/src/CognitiveSkills.sln'
      arguments: '--configuration Release /warnaserror'
      
  - task: DotNetCoreCLI@2
    displayName: Unit Test Azure Function package
    inputs:  
      command: test  
      projects: '$(Build.SourcesDirectory)/src/CognitiveSkills.Functions.Tests/*.csproj'
      publishTestResults: true  
      arguments: '--configuration Release /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput=$(Build.SourcesDirectory)/TestResults/Coverage/'

  - task: PublishCodeCoverageResults@1
    displayName: 'Publish code coverage report'
    inputs:
      codeCoverageTool: 'Cobertura'
      summaryFileLocation: '$(Build.SourcesDirectory)/**/coverage.cobertura.xml'

  - task: DotNetCoreCLI@2
    displayName: Create Azure Function package
    inputs:
      command: publish
      projects: '$(Build.SourcesDirectory)/src/CognitiveSkills.Functions'
      publishWebProjects: False
      arguments: '--configuration Release --output $(Build.ArtifactStagingDirectory)'
      zipAfterPublish: True

  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: skills

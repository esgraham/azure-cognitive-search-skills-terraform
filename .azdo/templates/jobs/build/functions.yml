jobs:
- job: BuildFunctions
  steps:
  - task: DotNetCoreCLI@2
    displayName: Restore NuGet packages
    inputs:
      command: 'restore'
      projects: '$(Build.SourcesDirectory)/src/CognitiveSkills.sln'

  - task: DotNetCoreCLI@2
    displayName: Build solution
    inputs:
      projects: '$(Build.SourcesDirectory)/src/CognitiveSkills.sln'
      arguments: '--configuration Release /warnaserror'

  - task: DotNetCoreCLI@2
    displayName: Create Azure Function package
    inputs:
      command: publish
      projects: '$(Build.SourcesDirectory)/src/CognitiveSkills.Functions'
      publishWebProjects: False
      arguments: '--configuration Release --output $(Build.ArtifactStagingDirectory)'
      zipAfterPublish: True
   
# Visual Studio test platform installer
- task: VisualStudioTestPlatformInstaller@1
  displayName: Install Visual Studio Test Platform
  inputs:
    packageFeedSelector: 'nugetOrg' 
    versionSelector: 'latestStable'

  - task: VSTest@2
    displayName: Unit Test Azure Function package
    inputs:
      testSelector: 'testAssemblies'
      testAssemblyVer2: '**\*Tests*.dll;!**\obj\**'
      searchFolder: '$(Build.SourcesDirectory)/src/CognitiveSkills.Functions.Tests'

  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: skills
